System.register([],function(t,i){"use strict";return{execute:function(){window.HPH&&(HPH.register("gallery",function(){return{instances:new Map,init:function(t,i={}){const n=t.querySelector(".hph-gallery, .listing-gallery, .property-gallery");if(!n)return;const e=n.id||"gallery-"+Date.now();if(this.instances.has(e))return this.instances.get(e);const o={autoplay:!1,loop:!0,navigation:!0,pagination:!0,touchSwipe:!0,lazy:!0,breakpoints:{768:{slidesPerView:1},1024:{slidesPerView:2},1200:{slidesPerView:3}},...i},r=this.createGallery(n,o);return this.instances.set(e,r),r},createGallery:function(t,i){const n=Array.from(t.querySelectorAll(".gallery-slide, .listing-image, .property-image"));return this.ensureControls(t),i.touchSwipe&&this.initTouchSwipe(t,()=>this.next(t),()=>this.prev(t)),i.lazy&&this.initLazyLoading(t),{gallery:t,slides:n,currentSlide:0,next:()=>this.next(t),prev:()=>this.prev(t),goTo:i=>this.goTo(t,i),destroy:()=>this.destroy(t)}},ensureControls:function(t){if(!t.querySelector(".gallery-nav")){const i=document.createElement("div");i.className="gallery-nav",i.innerHTML='\n                        <button class="gallery-prev" aria-label="Previous image">‹</button>\n                        <button class="gallery-next" aria-label="Next image">›</button>\n                    ',t.appendChild(i)}},initTouchSwipe:function(t,i,n){let e=0,o=0;t.addEventListener("touchstart",t=>{e=t.touches[0].clientX,o=t.touches[0].clientY}),t.addEventListener("touchend",t=>{const r=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,a=e-r,c=o-s;Math.abs(a)>Math.abs(c)&&Math.abs(a)>50&&(a>0?i():n())})},initLazyLoading:function(t){const i=t.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const t=new IntersectionObserver(i=>{i.forEach(i=>{if(i.isIntersecting){const n=i.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}})});i.forEach(i=>t.observe(i))}},next:function(t){const i=t.querySelectorAll(".gallery-slide, .listing-image, .property-image"),n=t.querySelector(".active")||i[0],e=(Array.from(i).indexOf(n)+1)%i.length;this.goTo(t,e)},prev:function(t){const i=t.querySelectorAll(".gallery-slide, .listing-image, .property-image"),n=t.querySelector(".active")||i[0],e=Array.from(i).indexOf(n),o=0===e?i.length-1:e-1;this.goTo(t,o)},goTo:function(t,i){t.querySelectorAll(".gallery-slide, .listing-image, .property-image").forEach((t,n)=>{t.classList.toggle("active",n===i)})}}}),HPH.register("maps",function(){return{instances:new Map,init:function(t,i={}){const n=t.querySelector(".hph-map, .listing-map, .property-map, .neighborhood-map");if(!n)return;const e=n.id||"map-"+Date.now();if(this.instances.has(e))return this.instances.get(e);const o={center:[39.8283,-98.5795],zoom:13,showNeighborhood:!0,showMarkers:!0,clusterMarkers:!0,...i},r=this.createMap(n,o);return this.instances.set(e,r),r},createMap:function(t,i){if(window.L){const n=L.map(t).setView(i.center,i.zoom);return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(n),i.showMarkers&&this.addMarkers(n,t),{map:n,addMarker:(t,i,e)=>this.addMarker(n,t,i,e),destroy:()=>n.remove()}}return t.innerHTML="<p>Map functionality requires location data</p>",{map:null}},addMarkers:function(t,i){const n=i.dataset.markers;if(n)try{JSON.parse(n).forEach(i=>{L.marker([i.lat,i.lng]).bindPopup(i.popup||"").addTo(t)})}catch(e){}},addMarker:function(t,i,n,e={}){return L.marker([i,n],e).addTo(t)}}}),HPH.register("listingForms",function(){return{init:function(t){t.querySelectorAll(".listing-contact-form, .property-inquiry-form, .showing-request-form").forEach(t=>this.initForm(t))},initForm:function(t){t.dataset.hphInitialized||(t.addEventListener("submit",i=>{i.preventDefault(),this.submitForm(t)}),this.populateListingData(t),t.dataset.hphInitialized="true")},populateListingData:function(t){const i=t.closest("[data-listing-id]")?.dataset.listingId,n=document.querySelector(".listing-title, .property-title")?.textContent;if(document.querySelector(".listing-price, .property-price"),i){const n=t.querySelector('input[name="listing_id"]');n&&(n.value=i)}if(n){const i=t.querySelector('input[name="subject"]');i&&!i.value&&(i.value=`Inquiry about: ${n}`)}},submitForm:function(t){const i=new FormData(t);i.append("action","hph_listing_contact"),i.append("nonce",window.hphNonce||""),window.HPH&&window.HPH.ajax&&window.HPH.ajax.submitForm(t,{data:i,onSuccess:i=>this.handleSuccess(t,i),onError:i=>this.handleError(t,i)})},handleSuccess:function(t,i){t.innerHTML='<div class="hph-alert hph-alert-success">Thank you! Your message has been sent.</div>'},handleError:function(t,i){const n=t.querySelector(".form-error")||document.createElement("div");n.className="hph-alert hph-alert-error",n.textContent="Sorry, there was an error sending your message. Please try again.",t.insertBefore(n,t.firstChild)}}}),HPH.register("listingFilters",function(){return{init:function(t){t.querySelectorAll(".listing-filters, .search-filters, .archive-filters").forEach(t=>this.initFilters(t))},initFilters:function(t){t.dataset.hphInitialized||(t.querySelectorAll("input, select").forEach(i=>{i.addEventListener("change",()=>this.applyFilters(t))}),t.querySelectorAll('input[type="range"]').forEach(t=>{t.addEventListener("input",()=>this.updatePriceDisplay(t))}),t.dataset.hphInitialized="true")},applyFilters:function(t){const i=new FormData(t),n=Object.fromEntries(i.entries());window.HPH&&window.HPH.ajax&&window.HPH.ajax.request({action:"hph_filter_listings",filters:n,nonce:window.hphNonce||""},{onSuccess:t=>this.updateResults(t),onError:t=>{}})},updatePriceDisplay:function(t){const i=t.nextElementSibling||t.parentNode.querySelector(".price-display");if(i){const n=parseInt(t.value);i.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(n)}},updateResults:function(t){const i=document.querySelector(".listing-results, .search-results, .archive-content");i&&t.html&&(i.innerHTML=t.html,this.initNewContent(i))},initNewContent:function(t){window.HPH&&(window.HPH.modules.gallery&&window.HPH.modules.gallery.init(t),window.HPH.modules.listingForms&&window.HPH.modules.listingForms.init(t))}}}),HPH.register("virtualTours",function(){return{init:function(t){t.querySelectorAll(".virtual-tour, .tour-iframe, .matterport-tour").forEach(t=>this.initTour(t))},initTour:function(t){if(t.dataset.hphInitialized)return;const i=t.dataset.tourUrl,n=t.dataset.tourType||"iframe";i&&this.loadTour(t,i,n),t.dataset.hphInitialized="true"},loadTour:function(t,i,n){switch(n){case"matterport":this.loadMatterport(t,i);break;case"youtube":this.loadYoutube(t,i);break;default:this.loadIframe(t,i)}},loadIframe:function(t,i){const n=document.createElement("iframe");n.src=i,n.width="100%",n.height="400",n.frameBorder="0",n.allowFullscreen=!0,t.appendChild(n)},loadMatterport:function(t,i){this.loadIframe(t,i)},loadYoutube:function(t,i){const n=this.extractYouTubeId(i);n&&this.loadIframe(t,`https://www.youtube.com/embed/${n}`)},extractYouTubeId:function(t){const i=t.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);return i?i[1]:null}}}),HPH.register("listingComparison",function(){return{compareList:[],maxCompare:3,init:function(t){t.querySelectorAll(".compare-listing, [data-compare]").forEach(t=>this.initCompareButton(t)),this.updateCompareDisplay()},initCompareButton:function(t){t.addEventListener("click",i=>{i.preventDefault();const n=t.dataset.listingId||t.dataset.compare;this.toggleCompare(n,t)})},toggleCompare:function(t,i){const n=this.compareList.indexOf(t);n>-1?(this.compareList.splice(n,1),i.classList.remove("active")):this.compareList.length<this.maxCompare?(this.compareList.push(t),i.classList.add("active")):alert(`You can only compare up to ${this.maxCompare} listings.`),this.updateCompareDisplay()},updateCompareDisplay:function(){const t=document.querySelector(".compare-widget");if(t){const i=this.compareList.length;t.style.display=i>0?"block":"none";const n=t.querySelector(".compare-count");n&&(n.textContent=i)}},viewComparison:function(){if(this.compareList.length<2)return void alert("Please select at least 2 listings to compare.");const t=`/compare-listings/?ids=${this.compareList.join(",")}`;window.location.href=t},clearComparison:function(){this.compareList=[],document.querySelectorAll(".compare-listing.active").forEach(t=>{t.classList.remove("active")}),this.updateCompareDisplay()}}}),HPH.register("initListings",function(){return{init:function(t=document){window.HPH.modules.gallery&&window.HPH.modules.gallery.init(t),window.HPH.modules.heroGallery&&window.HPH.modules.heroGallery.init(t),window.HPH.modules.maps&&window.HPH.modules.maps.init(t),window.HPH.modules.listingForms&&window.HPH.modules.listingForms.init(t),window.HPH.modules.listingFilters&&window.HPH.modules.listingFilters.init(t),window.HPH.modules.virtualTours&&window.HPH.modules.virtualTours.init(t),window.HPH.modules.listingComparison&&window.HPH.modules.listingComparison.init(t)}}})),window.hphDebug}}});
