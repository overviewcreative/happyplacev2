window.HPH?(HPH.register("gallery",function(){return{instances:new Map,init:function(t,e={}){const i=t.querySelector(".hph-gallery, .listing-gallery, .property-gallery");if(!i)return;const n=i.id||"gallery-"+Date.now();if(this.instances.has(n))return this.instances.get(n);const r={autoplay:!1,loop:!0,navigation:!0,pagination:!0,touchSwipe:!0,lazy:!0,breakpoints:{768:{slidesPerView:1},1024:{slidesPerView:2},1200:{slidesPerView:3}},...e},s=this.createGallery(i,r);return this.instances.set(n,s),s},createGallery:function(t,e){const i=Array.from(t.querySelectorAll(".gallery-slide, .listing-image, .property-image"));let n=0;return this.ensureControls(t),e.touchSwipe&&this.initTouchSwipe(t,()=>this.next(t),()=>this.prev(t)),e.lazy&&this.initLazyLoading(t),{gallery:t,slides:i,currentSlide:n,next:()=>this.next(t),prev:()=>this.prev(t),goTo:r=>this.goTo(t,r),destroy:()=>this.destroy(t)}},ensureControls:function(t){if(!t.querySelector(".gallery-nav")){const e=document.createElement("div");e.className="gallery-nav",e.innerHTML='\n                        <button class="gallery-prev" aria-label="Previous image">‹</button>\n                        <button class="gallery-next" aria-label="Next image">›</button>\n                    ',t.appendChild(e)}},initTouchSwipe:function(t,e,i){let n=0,r=0;t.addEventListener("touchstart",s=>{n=s.touches[0].clientX,r=s.touches[0].clientY}),t.addEventListener("touchend",s=>{const o=s.changedTouches[0].clientX,c=s.changedTouches[0].clientY,a=n-o,l=r-c;Math.abs(a)>Math.abs(l)&&Math.abs(a)>50&&(a>0?e():i())})},initLazyLoading:function(t){const e=t.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const i=new IntersectionObserver(n=>{n.forEach(r=>{if(r.isIntersecting){const s=r.target;s.src=s.dataset.src,s.removeAttribute("data-src"),i.unobserve(s)}})});e.forEach(n=>i.observe(n))}},next:function(t){const e=t.querySelectorAll(".gallery-slide, .listing-image, .property-image"),i=t.querySelector(".active")||e[0],r=(Array.from(e).indexOf(i)+1)%e.length;this.goTo(t,r)},prev:function(t){const e=t.querySelectorAll(".gallery-slide, .listing-image, .property-image"),i=t.querySelector(".active")||e[0],n=Array.from(e).indexOf(i),r=n===0?e.length-1:n-1;this.goTo(t,r)},goTo:function(t,e){t.querySelectorAll(".gallery-slide, .listing-image, .property-image").forEach((n,r)=>{n.classList.toggle("active",r===e)})}}}),HPH.register("maps",function(){return{instances:new Map,init:function(t,e={}){const i=t.querySelector(".hph-map, .listing-map, .property-map, .neighborhood-map");if(!i)return;const n=i.id||"map-"+Date.now();if(this.instances.has(n))return this.instances.get(n);const r={center:[39.8283,-98.5795],zoom:13,showNeighborhood:!0,showMarkers:!0,clusterMarkers:!0,...e},s=this.createMap(i,r);return this.instances.set(n,s),s},createMap:function(t,e){if(window.L){const i=L.map(t).setView(e.center,e.zoom);return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(i),e.showMarkers&&this.addMarkers(i,t),{map:i,addMarker:(n,r,s)=>this.addMarker(i,n,r,s),destroy:()=>i.remove()}}else return t.innerHTML="<p>Map functionality requires location data</p>",{map:null}},addMarkers:function(t,e){const i=e.dataset.markers;if(i)try{JSON.parse(i).forEach(r=>{L.marker([r.lat,r.lng]).bindPopup(r.popup||"").addTo(t)})}catch(n){console.warn("Invalid marker data:",n)}},addMarker:function(t,e,i,n={}){return L.marker([e,i],n).addTo(t)}}}),HPH.register("listingForms",function(){return{init:function(t){t.querySelectorAll(".listing-contact-form, .property-inquiry-form, .showing-request-form").forEach(i=>this.initForm(i))},initForm:function(t){t.dataset.hphInitialized||(t.addEventListener("submit",e=>{e.preventDefault(),this.submitForm(t)}),this.populateListingData(t),t.dataset.hphInitialized="true")},populateListingData:function(t){var n,r,s;const e=(n=t.closest("[data-listing-id]"))==null?void 0:n.dataset.listingId,i=(r=document.querySelector(".listing-title, .property-title"))==null?void 0:r.textContent;if((s=document.querySelector(".listing-price, .property-price"))==null||s.textContent,e){const o=t.querySelector('input[name="listing_id"]');o&&(o.value=e)}if(i){const o=t.querySelector('input[name="subject"]');o&&!o.value&&(o.value="Inquiry about: ".concat(i))}},submitForm:function(t){const e=new FormData(t);e.append("action","hph_listing_contact"),e.append("nonce",window.hphNonce||""),window.HPH&&window.HPH.ajax&&window.HPH.ajax.submitForm(t,{data:e,onSuccess:i=>this.handleSuccess(t,i),onError:i=>this.handleError(t,i)})},handleSuccess:function(t,e){t.innerHTML='<div class="hph-alert hph-alert-success">Thank you! Your message has been sent.</div>'},handleError:function(t,e){const i=t.querySelector(".form-error")||document.createElement("div");i.className="hph-alert hph-alert-error",i.textContent="Sorry, there was an error sending your message. Please try again.",t.insertBefore(i,t.firstChild)}}}),HPH.register("listingFilters",function(){return{init:function(t){t.querySelectorAll(".listing-filters, .search-filters, .archive-filters").forEach(i=>this.initFilters(i))},initFilters:function(t){if(t.dataset.hphInitialized)return;t.querySelectorAll("input, select").forEach(n=>{n.addEventListener("change",()=>this.applyFilters(t))}),t.querySelectorAll('input[type="range"]').forEach(n=>{n.addEventListener("input",()=>this.updatePriceDisplay(n))}),t.dataset.hphInitialized="true"},applyFilters:function(t){const e=new FormData(t),i=Object.fromEntries(e.entries());window.HPH&&window.HPH.ajax&&window.HPH.ajax.request({action:"hph_filter_listings",filters:i,nonce:window.hphNonce||""},{onSuccess:n=>this.updateResults(n),onError:n=>console.warn("Filter error:",n)})},updatePriceDisplay:function(t){const e=t.nextElementSibling||t.parentNode.querySelector(".price-display");if(e){const i=parseInt(t.value);e.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(i)}},updateResults:function(t){const e=document.querySelector(".listing-results, .search-results, .archive-content");e&&t.html&&(e.innerHTML=t.html,this.initNewContent(e))},initNewContent:function(t){window.HPH&&(window.HPH.modules.gallery&&window.HPH.modules.gallery.init(t),window.HPH.modules.listingForms&&window.HPH.modules.listingForms.init(t))}}}),HPH.register("virtualTours",function(){return{init:function(t){t.querySelectorAll(".virtual-tour, .tour-iframe, .matterport-tour").forEach(i=>this.initTour(i))},initTour:function(t){if(t.dataset.hphInitialized)return;const e=t.dataset.tourUrl,i=t.dataset.tourType||"iframe";e&&this.loadTour(t,e,i),t.dataset.hphInitialized="true"},loadTour:function(t,e,i){switch(i){case"matterport":this.loadMatterport(t,e);break;case"youtube":this.loadYoutube(t,e);break;default:this.loadIframe(t,e)}},loadIframe:function(t,e){const i=document.createElement("iframe");i.src=e,i.width="100%",i.height="400",i.frameBorder="0",i.allowFullscreen=!0,t.appendChild(i)},loadMatterport:function(t,e){this.loadIframe(t,e)},loadYoutube:function(t,e){const i=this.extractYouTubeId(e);i&&this.loadIframe(t,"https://www.youtube.com/embed/".concat(i))},extractYouTubeId:function(t){const e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,i=t.match(e);return i?i[1]:null}}}),HPH.register("listingComparison",function(){return{compareList:[],maxCompare:3,init:function(t){t.querySelectorAll(".compare-listing, [data-compare]").forEach(i=>this.initCompareButton(i)),this.updateCompareDisplay()},initCompareButton:function(t){t.addEventListener("click",e=>{e.preventDefault();const i=t.dataset.listingId||t.dataset.compare;this.toggleCompare(i,t)})},toggleCompare:function(t,e){const i=this.compareList.indexOf(t);i>-1?(this.compareList.splice(i,1),e.classList.remove("active")):this.compareList.length<this.maxCompare?(this.compareList.push(t),e.classList.add("active")):alert("You can only compare up to ".concat(this.maxCompare," listings.")),this.updateCompareDisplay()},updateCompareDisplay:function(){const t=document.querySelector(".compare-widget");if(t){const e=this.compareList.length;t.style.display=e>0?"block":"none";const i=t.querySelector(".compare-count");i&&(i.textContent=e)}},viewComparison:function(){if(this.compareList.length<2){alert("Please select at least 2 listings to compare.");return}const t="/compare-listings/?ids=".concat(this.compareList.join(","));window.location.href=t},clearComparison:function(){this.compareList=[],document.querySelectorAll(".compare-listing.active").forEach(t=>{t.classList.remove("active")}),this.updateCompareDisplay()}}}),HPH.register("initListings",function(){return{init:function(t=document){window.HPH.modules.gallery&&window.HPH.modules.gallery.init(t),window.HPH.modules.heroGallery&&window.HPH.modules.heroGallery.init(t),window.HPH.modules.maps&&window.HPH.modules.maps.init(t),window.HPH.modules.listingForms&&window.HPH.modules.listingForms.init(t),window.HPH.modules.listingFilters&&window.HPH.modules.listingFilters.init(t),window.HPH.modules.virtualTours&&window.HPH.modules.virtualTours.init(t),window.HPH.modules.listingComparison&&window.HPH.modules.listingComparison.init(t)}}})):console.warn("HPH Core system not found. Listing modules require unified core.");window.hphDebug&&console.log("Unified Listings System Loaded - All redundancies eliminated");
