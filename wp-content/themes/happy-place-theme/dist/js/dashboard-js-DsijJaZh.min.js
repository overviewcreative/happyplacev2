var C=Object.defineProperty;var g=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var b=(t,e,a)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,v=(t,e)=>{for(var a in e||(e={}))E.call(e,a)&&b(t,a,e[a]);if(g)for(var a of g(e))H.call(e,a)&&b(t,a,e[a]);return t};var d=(t,e,a)=>new Promise((o,n)=>{var i=r=>{try{l(a.next(r))}catch(c){n(c)}},s=r=>{try{l(a.throw(r))}catch(c){n(c)}},l=r=>r.done?o(r.value):Promise.resolve(r.value).then(i,s);l((a=a.apply(t,e)).next())});window.HPH?(HPH.register("crud",function(){return{init:function(t){this.initCreateForms(t),this.initEditForms(t),this.initDeleteButtons(t),this.initBulkActions(t)},initCreateForms:function(t){t.querySelectorAll('.add-listing, .add-lead, .create-new, [data-action="create"]').forEach(a=>{a.addEventListener("click",o=>{o.preventDefault(),this.openCreateModal(a.dataset.type||"listing")})})},initEditForms:function(t){t.querySelectorAll('.edit-listing, .edit-lead, .edit-item, [data-action="edit"]').forEach(a=>{a.addEventListener("click",o=>{o.preventDefault();const n=a.dataset.id,i=a.dataset.type||"listing";this.openEditModal(i,n)})})},initDeleteButtons:function(t){t.querySelectorAll('.delete-listing, .delete-lead, .delete-item, [data-action="delete"]').forEach(a=>{a.addEventListener("click",o=>{o.preventDefault();const n=a.dataset.id,i=a.dataset.type||"listing";this.confirmDelete(i,n,a)})})},initBulkActions:function(t){t.querySelectorAll(".bulk-actions-form, .dashboard-bulk-actions").forEach(a=>{const o=a.querySelector(".select-all"),n=a.querySelectorAll('input[type="checkbox"][name="items[]"]');a.querySelector(".bulk-action-select");const i=a.querySelector(".bulk-action-submit");o&&o.addEventListener("change",()=>{n.forEach(s=>s.checked=o.checked),this.updateBulkControls(a)}),n.forEach(s=>{s.addEventListener("change",()=>this.updateBulkControls(a))}),i&&i.addEventListener("click",s=>{s.preventDefault(),this.processBulkAction(a)})})},updateBulkControls:function(t){const e=t.querySelectorAll('input[type="checkbox"][name="items[]"]:checked'),a=t.querySelector(".bulk-actions");a&&(a.style.display=e.length>0?"block":"none")},openCreateModal:function(t){window.HPH.modules.modals&&window.HPH.modules.modals.open("create-".concat(t,"-modal"),{title:"Add New ".concat(t.charAt(0).toUpperCase()+t.slice(1)),onSave:e=>this.createItem(t,e)})},openEditModal:function(t,e){this.loadItemData(t,e).then(a=>{window.HPH.modules.modals&&window.HPH.modules.modals.open("edit-".concat(t,"-modal"),{title:"Edit ".concat(t.charAt(0).toUpperCase()+t.slice(1)),data:a,onSave:o=>this.updateItem(t,e,o)})})},loadItemData:function(t,e){return window.HPH.ajax.request({action:"hph_get_".concat(t,"_details"),id:e,nonce:window.hphNonce||""}).then(a=>a.data||{})},createItem:function(t,e){const a=new FormData;return a.append("action","hph_create_".concat(t)),a.append("nonce",window.hphNonce||""),Object.keys(e).forEach(o=>{a.append(o,e[o])}),window.HPH.ajax.submitForm(null,{data:a,onSuccess:o=>{this.handleCrudSuccess(t,"created",o),this.refreshDashboard()},onError:o=>this.handleCrudError(t,"create",o)})},updateItem:function(t,e,a){const o=new FormData;return o.append("action","hph_update_".concat(t)),o.append("id",e),o.append("nonce",window.hphNonce||""),Object.keys(a).forEach(n=>{o.append(n,a[n])}),window.HPH.ajax.submitForm(null,{data:o,onSuccess:n=>{this.handleCrudSuccess(t,"updated",n),this.refreshDashboard()},onError:n=>this.handleCrudError(t,"update",n)})},confirmDelete:function(t,e,a){confirm("Are you sure you want to delete this ".concat(t,"?"))&&this.deleteItem(t,e,a)},deleteItem:function(t,e,a){const o=a.textContent;a.textContent="Deleting...",a.disabled=!0,window.HPH.ajax.request({action:"hph_delete_".concat(t),id:e,nonce:window.hphNonce||""}).then(n=>{this.handleCrudSuccess(t,"deleted",n);const i=a.closest("tr, .dashboard-item");i&&i.remove()}).catch(n=>{this.handleCrudError(t,"delete",n),a.textContent=o,a.disabled=!1})},processBulkAction:function(t){const e=Array.from(t.querySelectorAll('input[type="checkbox"][name="items[]"]:checked')),a=t.querySelector(".bulk-action-select").value;if(e.length===0){alert("Please select items to perform bulk action.");return}if(!a){alert("Please select an action.");return}const o=e.map(n=>n.value);this.executeBulkAction(a,o,t)},executeBulkAction:function(t,e,a){window.HPH.ajax.request({action:"hph_bulk_action",bulk_action:t,ids:e,nonce:window.hphNonce||""}).then(o=>{this.handleCrudSuccess("items",t,o),this.refreshDashboard()}).catch(o=>{this.handleCrudError("items",t,o)})},handleCrudSuccess:function(t,e,a){window.HPH.modules.notifications&&window.HPH.modules.notifications.show("".concat(t," ").concat(e," successfully!"),"success")},handleCrudError:function(t,e,a){window.HPH.modules.notifications&&window.HPH.modules.notifications.show("Error ".concat(e," ").concat(t,": ").concat(a.message||"Unknown error"),"error")},refreshDashboard:function(){const t=new CustomEvent("dashboardRefresh");document.dispatchEvent(t)}}}),HPH.register("dataTables",function(){return{instances:new Map,init:function(t){t.querySelectorAll(".dashboard-table, .data-table, .listings-table, .leads-table").forEach(a=>this.initTable(a))},initTable:function(t){if(t.dataset.hphInitialized)return;const e={sortable:t.dataset.sortable!=="false",filterable:t.dataset.filterable!=="false",paginated:t.dataset.paginated!=="false",perPage:parseInt(t.dataset.perPage)||20},a=this.createTable(t,e);this.instances.set(t.id||"table-"+Date.now(),a),t.dataset.hphInitialized="true"},createTable:function(t,e){const a={table:t,config:e,currentPage:1,sortColumn:null,sortDirection:"asc",filterText:""};return e.sortable&&this.initSorting(a),e.filterable&&this.initFiltering(a),e.paginated&&this.initPagination(a),a},initSorting:function(t){t.table.querySelectorAll("th[data-sortable]").forEach(a=>{a.style.cursor="pointer",a.addEventListener("click",()=>{const o=a.dataset.sortable;this.sortTable(t,o)})})},initFiltering:function(t){let e=t.table.parentNode.querySelector(".table-filter");e||(e=document.createElement("input"),e.type="text",e.className="table-filter",e.placeholder="Filter table...",t.table.parentNode.insertBefore(e,t.table)),e.addEventListener("input",a=>{t.filterText=a.target.value.toLowerCase(),this.applyFilter(t)})},initPagination:function(t){this.createPagination(t),this.updatePagination(t)},sortTable:function(t,e){t.sortColumn===e?t.sortDirection=t.sortDirection==="asc"?"desc":"asc":(t.sortColumn=e,t.sortDirection="asc");const a=Array.from(t.table.querySelectorAll("tbody tr"));a.sort((n,i)=>{var c,u;const s=((c=n.querySelector('[data-sort="'.concat(e,'"]')))==null?void 0:c.textContent)||"",l=((u=i.querySelector('[data-sort="'.concat(e,'"]')))==null?void 0:u.textContent)||"",r=s.localeCompare(l,void 0,{numeric:!0});return t.sortDirection==="asc"?r:-r});const o=t.table.querySelector("tbody");a.forEach(n=>o.appendChild(n)),this.updateSortHeaders(t)},updateSortHeaders:function(t){t.table.querySelectorAll("th[data-sortable]").forEach(a=>{const o=a.dataset.sortable===t.sortColumn;a.classList.toggle("sort-active",o),a.classList.toggle("sort-asc",o&&t.sortDirection==="asc"),a.classList.toggle("sort-desc",o&&t.sortDirection==="desc")})},applyFilter:function(t){t.table.querySelectorAll("tbody tr").forEach(a=>{const o=a.textContent.toLowerCase(),n=!t.filterText||o.includes(t.filterText);a.style.display=n?"":"none"})},createPagination:function(t){const e=document.createElement("div");e.className="table-pagination",t.table.parentNode.appendChild(e),t.paginationContainer=e},updatePagination:function(t){const e=Array.from(t.table.querySelectorAll("tbody tr")).filter(o=>o.style.display!=="none"),a=Math.ceil(e.length/t.config.perPage);e.forEach((o,n)=>{const i=(t.currentPage-1)*t.config.perPage,s=i+t.config.perPage;o.style.display=n>=i&&n<s?"":"none"}),this.renderPaginationControls(t,a)},renderPaginationControls:function(t,e){if(e<=1){t.paginationContainer.innerHTML="";return}let a='<div class="pagination-controls">';t.currentPage>1&&(a+='<button class="page-btn" data-page="'.concat(t.currentPage-1,'">‹ Previous</button>'));for(let o=1;o<=e;o++){const n=o===t.currentPage;a+='<button class="page-btn '.concat(n?"active":"",'" data-page="').concat(o,'">').concat(o,"</button>")}t.currentPage<e&&(a+='<button class="page-btn" data-page="'.concat(t.currentPage+1,'">Next ›</button>')),a+="</div>",t.paginationContainer.innerHTML=a,t.paginationContainer.querySelectorAll(".page-btn").forEach(o=>{o.addEventListener("click",()=>{t.currentPage=parseInt(o.dataset.page),this.updatePagination(t)})})}}}),HPH.register("modals",function(){return{activeModal:null,init:function(t){this.createModalContainer(),this.initModalTriggers(t)},createModalContainer:function(){if(document.getElementById("hph-modal-container"))return;const t=document.createElement("div");t.id="hph-modal-container",t.className="hph-modal-overlay",t.innerHTML='\n                    <div class="hph-modal">\n                        <div class="hph-modal-header">\n                            <h3 class="hph-modal-title"></h3>\n                            <button class="hph-modal-close" aria-label="Close modal">&times;</button>\n                        </div>\n                        <div class="hph-modal-body"></div>\n                        <div class="hph-modal-footer">\n                            <button class="hph-btn hph-btn-secondary hph-modal-cancel">Cancel</button>\n                            <button class="hph-btn hph-btn-primary hph-modal-save">Save</button>\n                        </div>\n                    </div>\n                ',document.body.appendChild(t),t.querySelector(".hph-modal-close").addEventListener("click",()=>this.close()),t.querySelector(".hph-modal-cancel").addEventListener("click",()=>this.close()),t.addEventListener("click",e=>{e.target===t&&this.close()})},initModalTriggers:function(t){t.querySelectorAll("[data-modal]").forEach(a=>{a.addEventListener("click",o=>{o.preventDefault();const n=a.dataset.modal;this.open(n,{trigger:a})})})},open:function(t,e={}){const a=document.getElementById("hph-modal-container"),o=a.querySelector(".hph-modal"),n=a.querySelector(".hph-modal-title");n.textContent=e.title||t.replace("-"," ").replace(/\b\w/g,i=>i.toUpperCase()),this.loadModalContent(t,e),a.style.display="flex",o.style.opacity="0",o.style.transform="scale(0.9)",requestAnimationFrame(()=>{o.style.transition="all 0.3s ease",o.style.opacity="1",o.style.transform="scale(1)"}),this.activeModal={id:t,options:e},document.body.style.overflow="hidden"},loadModalContent:function(t,e){const a=document.querySelector(".hph-modal-body"),o=document.querySelector(".hph-modal-save");t.includes("listing")?this.loadListingForm(a,e):t.includes("lead")?this.loadLeadForm(a,e):this.loadGenericForm(a,e),o.onclick=()=>{if(e.onSave){const n=this.collectFormData(a);e.onSave(n)}this.close()}},loadListingForm:function(t,e){t.innerHTML='\n                    <form class="modal-form">\n                        <div class="form-group">\n                            <label for="listing-title">Property Title</label>\n                            <input type="text" id="listing-title" name="title" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-price">Price</label>\n                            <input type="number" id="listing-price" name="price" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-address">Address</label>\n                            <input type="text" id="listing-address" name="address" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-description">Description</label>\n                            <textarea id="listing-description" name="description" rows="4"></textarea>\n                        </div>\n                    </form>\n                ',e.data&&this.populateForm(t.querySelector(".modal-form"),e.data)},loadLeadForm:function(t,e){t.innerHTML='\n                    <form class="modal-form">\n                        <div class="form-group">\n                            <label for="lead-name">Name</label>\n                            <input type="text" id="lead-name" name="name" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-email">Email</label>\n                            <input type="email" id="lead-email" name="email" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-phone">Phone</label>\n                            <input type="tel" id="lead-phone" name="phone">\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-status">Status</label>\n                            <select id="lead-status" name="status">\n                                <option value="new">New</option>\n                                <option value="contacted">Contacted</option>\n                                <option value="qualified">Qualified</option>\n                                <option value="closed">Closed</option>\n                            </select>\n                        </div>\n                    </form>\n                ',e.data&&this.populateForm(t.querySelector(".modal-form"),e.data)},loadGenericForm:function(t,e){t.innerHTML="<p>Generic form content would go here</p>"},populateForm:function(t,e){Object.keys(e).forEach(a=>{const o=t.querySelector('[name="'.concat(a,'"]'));o&&(o.value=e[a])})},collectFormData:function(t){const e=t.querySelector(".modal-form");if(!e)return{};const a=new FormData(e);return Object.fromEntries(a.entries())},close:function(){const t=document.getElementById("hph-modal-container"),e=t.querySelector(".hph-modal");e.style.opacity="0",e.style.transform="scale(0.9)",setTimeout(()=>{t.style.display="none",document.body.style.overflow="",this.activeModal=null},300)}}}),HPH.register("analytics",function(){return{charts:new Map,init:function(t){this.initStatCards(t),this.initCharts(t),this.initReports(t)},initStatCards:function(t){t.querySelectorAll(".stat-card, .dashboard-stat").forEach(a=>this.enhanceStatCard(a))},enhanceStatCard:function(t){const e=t.querySelector(".stat-value"),a=e==null?void 0:e.dataset.target;a&&e&&this.animateNumber(e,0,parseInt(a),1e3)},animateNumber:function(t,e,a,o){const n=performance.now(),i=s=>{const l=s-n,r=Math.min(l/o,1),c=Math.floor(e+(a-e)*r);t.textContent=c.toLocaleString(),r<1&&requestAnimationFrame(i)};requestAnimationFrame(i)},initCharts:function(t){t.querySelectorAll(".chart, .analytics-chart").forEach(a=>this.createChart(a))},createChart:function(t){const e=t.dataset.chartType||"line",a=this.parseChartData(t),o=document.createElement("canvas");t.appendChild(o);const n={element:t,canvas:o,type:e,data:a};this.renderChart(n),this.charts.set(t.id||"chart-"+Date.now(),n)},parseChartData:function(t){try{return JSON.parse(t.dataset.chartData||"{}")}catch(e){return{labels:[],datasets:[]}}},renderChart:function(t){var n;const e=t.canvas.getContext("2d"),{width:a,height:o}=t.canvas.getBoundingClientRect();t.canvas.width=a,t.canvas.height=o,t.type==="line"&&((n=t.data.datasets)!=null&&n.length)&&this.drawLineChart(e,t.data,a,o)},drawLineChart:function(t,e,a,o){var l,r;const i=a-80,s=o-2*40;if(t.clearRect(0,0,a,o),t.strokeStyle="#3b82f6",t.lineWidth=2,(r=(l=e.datasets[0])==null?void 0:l.data)!=null&&r.length){const c=e.datasets[0].data,u=Math.max(...c),h=Math.min(...c),w=u-h||1;t.beginPath(),c.forEach((S,m)=>{const f=40+m/(c.length-1)*i,p=40+s-(S-h)/w*s;m===0?t.moveTo(f,p):t.lineTo(f,p)}),t.stroke()}},initReports:function(t){t.querySelectorAll(".generate-report, [data-report]").forEach(a=>{a.addEventListener("click",o=>{o.preventDefault();const n=a.dataset.report||"general";this.generateReport(n)})})},generateReport:function(t){window.HPH.ajax.request({action:"hph_generate_report",report_type:t,nonce:window.hphNonce||""}).then(e=>{e.download_url&&window.open(e.download_url,"_blank")}).catch(e=>{console.warn("Report generation failed:",e)})}}}),HPH.register("initDashboard",function(){return{init:function(t=document){window.HPH.modules.crud&&window.HPH.modules.crud.init(t),window.HPH.modules.dataTables&&window.HPH.modules.dataTables.init(t),window.HPH.modules.modals&&window.HPH.modules.modals.init(t),window.HPH.modules.analytics&&window.HPH.modules.analytics.init(t),this.initDashboardSpecific(t)},initDashboardSpecific:function(t){document.addEventListener("dashboardRefresh",()=>{this.refreshDashboardData()}),t.querySelectorAll(".auto-save-form").forEach(a=>{a.querySelectorAll("input, select, textarea").forEach(n=>{n.addEventListener("change",()=>{this.autoSaveForm(a)})})})},refreshDashboardData:function(){const t=document.querySelectorAll(".stat-card"),e=document.querySelectorAll(".dashboard-table");t.forEach(a=>{this.reloadStatCard(a)}),e.forEach(a=>{this.reloadTable(a)})},reloadStatCard:function(t){const e=t.dataset.endpoint;e&&window.HPH.ajax.request({action:e}).then(a=>{const o=t.querySelector(".stat-value");o&&a.value!==void 0&&(o.textContent=a.value)})},reloadTable:function(t){const e=t.dataset.endpoint;e&&window.HPH.ajax.request({action:e}).then(a=>{if(a.html){const o=t.querySelector("tbody");o.innerHTML=a.html}})},autoSaveForm:function(t){const e=new FormData(t);e.append("action","hph_auto_save"),e.append("nonce",window.hphNonce||""),window.HPH.ajax.submitForm(t,{data:e,onSuccess:()=>{this.showSaveIndicator(t)}})},showSaveIndicator:function(t){let e=t.querySelector(".save-indicator");e||(e=document.createElement("span"),e.className="save-indicator",e.textContent="Saved",t.appendChild(e)),e.style.opacity="1",setTimeout(()=>{e.style.opacity="0"},2e3)}}})):console.warn("HPH Core system not found. Dashboard modules require unified core.");window.hphDebug&&console.log("Unified Dashboard System Loaded - All CRUD/Analytics/Management redundancies eliminated");class y{constructor(){this.isLoggedIn=(HPUserSystem==null?void 0:HPUserSystem.isLoggedIn)||!1,this.userId=(HPUserSystem==null?void 0:HPUserSystem.userId)||0,this.nonce=(HPUserSystem==null?void 0:HPUserSystem.nonce)||"",this.ajaxUrl=(HPUserSystem==null?void 0:HPUserSystem.ajaxUrl)||"/wp-admin/admin-ajax.php",this.pageStartTime=Date.now(),this.maxScrollDepth=0,this.currentListingId=this.getCurrentListingId(),this.init()}init(){this.initFavoriteButtons(),this.initSaveSearchButtons(),this.initQuickRegistration(),this.initEngagementTracking(),this.initDashboard(),this.initModals(),this.currentListingId&&this.trackListingView()}initFavoriteButtons(){document.addEventListener("click",e=>{e.target.closest(".favorite-btn, .btn-favorite")&&(e.preventDefault(),this.handleFavoriteToggle(e.target.closest(".favorite-btn, .btn-favorite")))})}handleFavoriteToggle(e){return d(this,null,function*(){const a=e.dataset.listingId;if(!a)return;if(!this.isLoggedIn){this.showLoginPrompt("Save your favorite properties",{benefits:["Save unlimited favorite properties","Get email alerts for new matches","Track your viewing history"]});return}e.classList.add("loading");const o=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',e.disabled=!0;try{const n=yield this.makeRequest("hph_toggle_favorite",{listing_id:a,nonce:this.nonce});n.success?(this.updateFavoriteButton(e,n.data),this.showNotification(n.data.action==="added"?"Property saved to favorites!":"Property removed from favorites",n.data.action==="added"?"success":"info"),this.updateFavoritesCount(n.data.count)):this.showNotification(n.data.message||"Error updating favorite","error")}catch(n){this.showNotification("Error updating favorite","error")}finally{e.classList.remove("loading"),e.innerHTML=o,e.disabled=!1}})}updateFavoriteButton(e,a){const o=e.querySelector("i"),n=e.querySelector(".btn-text");a.is_favorited?(e.classList.add("is-favorited"),o&&(o.classList.remove("far"),o.classList.add("fas")),n&&(n.textContent=e.dataset.textRemove||"Saved")):(e.classList.remove("is-favorited"),o&&(o.classList.remove("fas"),o.classList.add("far")),n&&(n.textContent=e.dataset.textAdd||"Save Property"))}updateFavoritesCount(e){document.querySelectorAll(".favorites-count").forEach(o=>{o.textContent=e,o.style.display=e>0?"inline":"none"})}initSaveSearchButtons(){document.addEventListener("click",e=>{e.target.closest(".save-search-btn, #save-current-search")&&(e.preventDefault(),this.handleSaveSearch(e.target.closest(".save-search-btn, #save-current-search")))})}handleSaveSearch(e){return d(this,null,function*(){if(!this.isLoggedIn){this.showLoginPrompt("Save your search and get email alerts",{conversion_context:"save_search"});return}const a=this.getCurrentSearchParams();if(Object.keys(a).length===0){this.showNotification("Please perform a search first","warning");return}this.showSaveSearchModal(a)})}getCurrentSearchParams(){const e={};return new URLSearchParams(window.location.search).forEach((n,i)=>{n&&i!=="paged"&&(e[i]=n)}),document.querySelectorAll(".active-filter").forEach(n=>{const i=n.dataset.filterKey,s=n.dataset.filterValue;i&&s&&(e[i]=s)}),e}showSaveSearchModal(e){const a=document.getElementById("save-search-modal");if(!a){this.createSaveSearchModal(e);return}this.populateSearchCriteria(e),new bootstrap.Modal(a).show()}createSaveSearchModal(e){document.body.insertAdjacentHTML("beforeend",'\n            <div class="modal fade" id="dynamic-save-search-modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title">Save Your Search</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <form id="dynamic-save-search-form">\n                                <div class="mb-3">\n                                    <label for="search-name-dynamic" class="form-label">Search Name</label>\n                                    <input type="text" class="form-control" id="search-name-dynamic" name="search_name" \n                                           placeholder="e.g., 3BR Houses in Downtown" required>\n                                </div>\n                                \n                                <div class="mb-3">\n                                    <label for="email-frequency-dynamic" class="form-label">Email Frequency</label>\n                                    <select class="form-select" id="email-frequency-dynamic" name="frequency">\n                                        <option value="instant">Instant</option>\n                                        <option value="daily" selected>Daily</option>\n                                        <option value="weekly">Weekly</option>\n                                        <option value="monthly">Monthly</option>\n                                    </select>\n                                </div>\n                                \n                                <div class="search-criteria-summary">\n                                    <h6>Search Criteria:</h6>\n                                    <div id="criteria-list-dynamic"></div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                            <button type="submit" form="dynamic-save-search-form" class="btn btn-primary">Save Search</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),this.populateSearchCriteria(e,"criteria-list-dynamic"),document.getElementById("dynamic-save-search-form").addEventListener("submit",i=>{i.preventDefault(),this.submitSaveSearch(i.target,e)});const o=document.getElementById("dynamic-save-search-modal");new bootstrap.Modal(o).show(),o.addEventListener("hidden.bs.modal",()=>{o.remove()})}populateSearchCriteria(e,a="search-criteria-summary"){const o=document.getElementById(a);if(!o)return;const n={s:"Keywords",location:"Location",property_type:"Property Type",min_price:"Min Price",max_price:"Max Price",bedrooms:"Bedrooms",bathrooms:"Bathrooms",features:"Features"};let i="";Object.keys(e).forEach(s=>{const l=n[s]||s.replace("_"," "),r=e[s];i+='<span class="badge bg-secondary me-1 mb-1">'.concat(l,": ").concat(r,"</span>")}),o.innerHTML=i||'<span class="text-muted">No specific criteria</span>'}submitSaveSearch(e,a){return d(this,null,function*(){const o=new FormData(e),n=o.get("search_name"),i=o.get("frequency");if(!n.trim()){this.showNotification("Please enter a search name","warning");return}const s=e.querySelector('[type="submit"]');s.disabled=!0,s.innerHTML='<i class="fas fa-spinner fa-spin"></i> Saving...';try{const l=yield this.makeRequest("hph_save_search",{search_name:n,criteria:a,frequency:i,nonce:this.nonce});l.success?(this.showNotification("Search saved successfully! You'll receive email alerts for new matches.","success"),bootstrap.Modal.getInstance(e.closest(".modal")).hide()):this.showNotification(l.data.message||"Error saving search","error")}catch(l){this.showNotification("Error saving search","error")}finally{s.disabled=!1,s.innerHTML="Save Search"}})}initQuickRegistration(){document.addEventListener("submit",e=>{e.target.classList.contains("quick-registration-form")&&(e.preventDefault(),this.handleQuickRegistration(e.target))})}handleQuickRegistration(e){return d(this,null,function*(){const a=new FormData(e),o=e.querySelector('[type="submit"]'),n=a.get("email"),i=a.get("first_name");if(!n||!i){this.showNotification("Please fill in all required fields","warning");return}const s=o.querySelector(".btn-text"),l=o.querySelector(".btn-loading");s&&l&&(s.style.display="none",l.style.display="inline"),o.disabled=!0;try{const r=yield this.makeRequest("quick_register",{first_name:a.get("first_name"),last_name:a.get("last_name"),email:a.get("email"),nonce:e.dataset.nonce||this.nonce});r.success?(this.showNotification(r.data.message,"success"),r.data.redirect?setTimeout(()=>{window.location.href=r.data.redirect},2e3):setTimeout(()=>{window.location.reload()},2e3)):this.showNotification(r.data.message||"Registration failed","error")}catch(r){this.showNotification("Registration error. Please try again.","error")}finally{s&&l&&(s.style.display="inline",l.style.display="none"),o.disabled=!1}})}initEngagementTracking(){let e=0;window.addEventListener("scroll",()=>{const a=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);a>e&&(e=a,this.maxScrollDepth=e)}),window.addEventListener("beforeunload",()=>{this.trackTimeOnPage()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.trackTimeOnPage()})}trackTimeOnPage(){if(!this.isLoggedIn)return;const e=Math.floor((Date.now()-this.pageStartTime)/1e3),a=Math.floor(e/60);if(a>0){const o=new URLSearchParams({action:"hph_track_engagement",user_id:this.userId,engagement_action:"time_on_site",minutes:a,scroll_depth:this.maxScrollDepth});navigator.sendBeacon(this.ajaxUrl,o)}}trackListingView(){const e=Date.now();setTimeout(()=>{const a=Math.floor((Date.now()-e)/1e3);this.makeRequest("track_listing_view_enhanced",{listing_id:this.currentListingId,view_time:a,scroll_depth:this.maxScrollDepth,source:"single_listing"}).catch(o=>{})},1e4)}getCurrentListingId(){const e=document.querySelector("[data-listing-id]");return e?e.dataset.listingId:null}initDashboard(){if(window.location.hash&&document.querySelector(".user-dashboard")){const e=window.location.hash.substring(1),a=document.querySelector('[data-bs-target="#'.concat(e,'"]'));a&&new bootstrap.Tab(a).show()}document.addEventListener("shown.bs.tab",e=>{const a=e.target.getAttribute("data-bs-target");if(a){const o=a.substring(1);history.replaceState(null,null,"#"+o)}}),this.loadDashboardData()}loadDashboardData(){return d(this,null,function*(){if(document.querySelector(".user-dashboard"))try{const e=document.getElementById("recent-activity");e&&(e.innerHTML='<p class="text-muted">Recent activity will be displayed here.</p>');const a=document.getElementById("recommendations");a&&(a.innerHTML='<p class="text-muted">Recommendations will appear here.</p>')}catch(e){}})}initModals(){}showLoginPrompt(e,a={}){const o='\n            <div class="modal fade" id="login-prompt-modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title">Sign In Required</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <p class="lead">'.concat(e,"</p>\n                            ").concat(a.benefits?'\n                                <div class="benefits-list mb-3">\n                                    <h6>With your free account you can:</h6>\n                                    <ul class="list-unstyled">\n                                        '.concat(a.benefits.map(l=>'<li><i class="fas fa-check text-success me-2"></i>'.concat(l,"</li>")).join(""),"\n                                    </ul>\n                                </div>\n                            "):"",'\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Maybe Later</button>\n                            <a href="/login?redirect_to=').concat(encodeURIComponent(window.location.href),'" class="btn btn-primary">Sign In</a>\n                            <a href="/register?redirect_to=').concat(encodeURIComponent(window.location.href),'" class="btn btn-success">Create Free Account</a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),n=document.getElementById("login-prompt-modal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",o);const i=document.getElementById("login-prompt-modal");new bootstrap.Modal(i).show(),i.addEventListener("hidden.bs.modal",()=>{i.remove()})}showNotification(e,a="info"){let o=document.querySelector(".toast-container");o||(o=document.createElement("div"),o.className="toast-container position-fixed top-0 end-0 p-3",document.body.appendChild(o));const n="toast-"+Date.now(),i={success:"fa-check-circle text-success",error:"fa-times-circle text-danger",warning:"fa-exclamation-triangle text-warning",info:"fa-info-circle text-info"},s=i[a]||i.info,l='\n            <div id="'.concat(n,'" class="toast" role="alert">\n                <div class="toast-header">\n                    <i class="fas ').concat(s,' me-2"></i>\n                    <strong class="me-auto">Notification</strong>\n                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>\n                </div>\n                <div class="toast-body">\n                    ').concat(e,"\n                </div>\n            </div>\n        ");o.insertAdjacentHTML("beforeend",l);const r=document.getElementById(n);new bootstrap.Toast(r,{autohide:!0,delay:a==="error"?8e3:5e3}).show(),r.addEventListener("hidden.bs.toast",()=>{r.remove()})}makeRequest(o){return d(this,arguments,function*(e,a={}){const n=new URLSearchParams(v({action:e},a)),i=yield fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n});if(!i.ok)throw new Error("HTTP error! status: ".concat(i.status));return yield i.json()})}}document.addEventListener("DOMContentLoaded",()=>{window.userSystem=new y});window.UserSystemManager=y;window.hphDebug&&console.log("HPH Unified Dashboard Bundle Loaded - CRUD/Analytics/Management Redundancies Eliminated");
