System.register([],function(t,n){"use strict";return{execute:function(){window.HPH&&(HPH.register("crud",function(){return{init:function(t){this.initCreateForms(t),this.initEditForms(t),this.initDeleteButtons(t),this.initBulkActions(t)},initCreateForms:function(t){t.querySelectorAll('.add-listing, .add-lead, .create-new, [data-action="create"]').forEach(t=>{t.addEventListener("click",n=>{n.preventDefault(),this.openCreateModal(t.dataset.type||"listing")})})},initEditForms:function(t){t.querySelectorAll('.edit-listing, .edit-lead, .edit-item, [data-action="edit"]').forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const e=t.dataset.id,i=t.dataset.type||"listing";this.openEditModal(i,e)})})},initDeleteButtons:function(t){t.querySelectorAll('.delete-listing, .delete-lead, .delete-item, [data-action="delete"]').forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const e=t.dataset.id,i=t.dataset.type||"listing";this.confirmDelete(i,e,t)})})},initBulkActions:function(t){t.querySelectorAll(".bulk-actions-form, .dashboard-bulk-actions").forEach(t=>{const n=t.querySelector(".select-all"),e=t.querySelectorAll('input[type="checkbox"][name="items[]"]');t.querySelector(".bulk-action-select");const i=t.querySelector(".bulk-action-submit");n&&n.addEventListener("change",()=>{e.forEach(t=>t.checked=n.checked),this.updateBulkControls(t)}),e.forEach(n=>{n.addEventListener("change",()=>this.updateBulkControls(t))}),i&&i.addEventListener("click",n=>{n.preventDefault(),this.processBulkAction(t)})})},updateBulkControls:function(t){const n=t.querySelectorAll('input[type="checkbox"][name="items[]"]:checked'),e=t.querySelector(".bulk-actions");e&&(e.style.display=n.length>0?"block":"none")},openCreateModal:function(t){window.HPH.modules.modals&&window.HPH.modules.modals.open(`create-${t}-modal`,{title:`Add New ${t.charAt(0).toUpperCase()+t.slice(1)}`,onSave:n=>this.createItem(t,n)})},openEditModal:function(t,n){this.loadItemData(t,n).then(e=>{window.HPH.modules.modals&&window.HPH.modules.modals.open(`edit-${t}-modal`,{title:`Edit ${t.charAt(0).toUpperCase()+t.slice(1)}`,data:e,onSave:e=>this.updateItem(t,n,e)})})},loadItemData:function(t,n){return window.HPH.ajax.request({action:`hph_get_${t}_details`,id:n,nonce:window.hphNonce||""}).then(t=>t.data||{})},createItem:function(t,n){const e=new FormData;return e.append("action",`hph_create_${t}`),e.append("nonce",window.hphNonce||""),Object.keys(n).forEach(t=>{e.append(t,n[t])}),window.HPH.ajax.submitForm(null,{data:e,onSuccess:n=>{this.handleCrudSuccess(t,"created",n),this.refreshDashboard()},onError:n=>this.handleCrudError(t,"create",n)})},updateItem:function(t,n,e){const i=new FormData;return i.append("action",`hph_update_${t}`),i.append("id",n),i.append("nonce",window.hphNonce||""),Object.keys(e).forEach(t=>{i.append(t,e[t])}),window.HPH.ajax.submitForm(null,{data:i,onSuccess:n=>{this.handleCrudSuccess(t,"updated",n),this.refreshDashboard()},onError:n=>this.handleCrudError(t,"update",n)})},confirmDelete:function(t,n,e){confirm(`Are you sure you want to delete this ${t}?`)&&this.deleteItem(t,n,e)},deleteItem:function(t,n,e){const i=e.textContent;e.textContent="Deleting...",e.disabled=!0,window.HPH.ajax.request({action:`hph_delete_${t}`,id:n,nonce:window.hphNonce||""}).then(n=>{this.handleCrudSuccess(t,"deleted",n);const i=e.closest("tr, .dashboard-item");i&&i.remove()}).catch(n=>{this.handleCrudError(t,"delete",n),e.textContent=i,e.disabled=!1})},processBulkAction:function(t){const n=Array.from(t.querySelectorAll('input[type="checkbox"][name="items[]"]:checked')),e=t.querySelector(".bulk-action-select").value;if(0===n.length)return void alert("Please select items to perform bulk action.");if(!e)return void alert("Please select an action.");const i=n.map(t=>t.value);this.executeBulkAction(e,i,t)},executeBulkAction:function(t,n,e){window.HPH.ajax.request({action:"hph_bulk_action",bulk_action:t,ids:n,nonce:window.hphNonce||""}).then(n=>{this.handleCrudSuccess("items",t,n),this.refreshDashboard()}).catch(n=>{this.handleCrudError("items",t,n)})},handleCrudSuccess:function(t,n,e){window.HPH.modules.notifications&&window.HPH.modules.notifications.show(`${t} ${n} successfully!`,"success")},handleCrudError:function(t,n,e){window.HPH.modules.notifications&&window.HPH.modules.notifications.show(`Error ${n} ${t}: ${e.message||"Unknown error"}`,"error")},refreshDashboard:function(){const t=new CustomEvent("dashboardRefresh");document.dispatchEvent(t)}}}),HPH.register("dataTables",function(){return{instances:new Map,init:function(t){t.querySelectorAll(".dashboard-table, .data-table, .listings-table, .leads-table").forEach(t=>this.initTable(t))},initTable:function(t){if(t.dataset.hphInitialized)return;const n={sortable:"false"!==t.dataset.sortable,filterable:"false"!==t.dataset.filterable,paginated:"false"!==t.dataset.paginated,perPage:parseInt(t.dataset.perPage)||20},e=this.createTable(t,n);this.instances.set(t.id||"table-"+Date.now(),e),t.dataset.hphInitialized="true"},createTable:function(t,n){const e={table:t,config:n,currentPage:1,sortColumn:null,sortDirection:"asc",filterText:""};return n.sortable&&this.initSorting(e),n.filterable&&this.initFiltering(e),n.paginated&&this.initPagination(e),e},initSorting:function(t){t.table.querySelectorAll("th[data-sortable]").forEach(n=>{n.style.cursor="pointer",n.addEventListener("click",()=>{const e=n.dataset.sortable;this.sortTable(t,e)})})},initFiltering:function(t){let n=t.table.parentNode.querySelector(".table-filter");n||(n=document.createElement("input"),n.type="text",n.className="table-filter",n.placeholder="Filter table...",t.table.parentNode.insertBefore(n,t.table)),n.addEventListener("input",n=>{t.filterText=n.target.value.toLowerCase(),this.applyFilter(t)})},initPagination:function(t){this.createPagination(t),this.updatePagination(t)},sortTable:function(t,n){t.sortColumn===n?t.sortDirection="asc"===t.sortDirection?"desc":"asc":(t.sortColumn=n,t.sortDirection="asc");const e=Array.from(t.table.querySelectorAll("tbody tr"));e.sort((e,i)=>{const o=e.querySelector(`[data-sort="${n}"]`)?.textContent||"",a=i.querySelector(`[data-sort="${n}"]`)?.textContent||"",s=o.localeCompare(a,void 0,{numeric:!0});return"asc"===t.sortDirection?s:-s});const i=t.table.querySelector("tbody");e.forEach(t=>i.appendChild(t)),this.updateSortHeaders(t)},updateSortHeaders:function(t){t.table.querySelectorAll("th[data-sortable]").forEach(n=>{const e=n.dataset.sortable===t.sortColumn;n.classList.toggle("sort-active",e),n.classList.toggle("sort-asc",e&&"asc"===t.sortDirection),n.classList.toggle("sort-desc",e&&"desc"===t.sortDirection)})},applyFilter:function(t){t.table.querySelectorAll("tbody tr").forEach(n=>{const e=n.textContent.toLowerCase(),i=!t.filterText||e.includes(t.filterText);n.style.display=i?"":"none"})},createPagination:function(t){const n=document.createElement("div");n.className="table-pagination",t.table.parentNode.appendChild(n),t.paginationContainer=n},updatePagination:function(t){const n=Array.from(t.table.querySelectorAll("tbody tr")).filter(t=>"none"!==t.style.display),e=Math.ceil(n.length/t.config.perPage);n.forEach((n,e)=>{const i=(t.currentPage-1)*t.config.perPage,o=i+t.config.perPage;n.style.display=e>=i&&e<o?"":"none"}),this.renderPaginationControls(t,e)},renderPaginationControls:function(t,n){if(n<=1)return void(t.paginationContainer.innerHTML="");let e='<div class="pagination-controls">';t.currentPage>1&&(e+=`<button class="page-btn" data-page="${t.currentPage-1}">‹ Previous</button>`);for(let i=1;i<=n;i++)e+=`<button class="page-btn ${i===t.currentPage?"active":""}" data-page="${i}">${i}</button>`;t.currentPage<n&&(e+=`<button class="page-btn" data-page="${t.currentPage+1}">Next ›</button>`),e+="</div>",t.paginationContainer.innerHTML=e,t.paginationContainer.querySelectorAll(".page-btn").forEach(n=>{n.addEventListener("click",()=>{t.currentPage=parseInt(n.dataset.page),this.updatePagination(t)})})}}}),HPH.register("modals",function(){return{activeModal:null,init:function(t){this.createModalContainer(),this.initModalTriggers(t)},createModalContainer:function(){if(document.getElementById("hph-modal-container"))return;const t=document.createElement("div");t.id="hph-modal-container",t.className="hph-modal-overlay",t.innerHTML='\n                    <div class="hph-modal">\n                        <div class="hph-modal-header">\n                            <h3 class="hph-modal-title"></h3>\n                            <button class="hph-modal-close" aria-label="Close modal">&times;</button>\n                        </div>\n                        <div class="hph-modal-body"></div>\n                        <div class="hph-modal-footer">\n                            <button class="hph-btn hph-btn-secondary hph-modal-cancel">Cancel</button>\n                            <button class="hph-btn hph-btn-primary hph-modal-save">Save</button>\n                        </div>\n                    </div>\n                ',document.body.appendChild(t),t.querySelector(".hph-modal-close").addEventListener("click",()=>this.close()),t.querySelector(".hph-modal-cancel").addEventListener("click",()=>this.close()),t.addEventListener("click",n=>{n.target===t&&this.close()})},initModalTriggers:function(t){t.querySelectorAll("[data-modal]").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const e=t.dataset.modal;this.open(e,{trigger:t})})})},open:function(t,n={}){const e=document.getElementById("hph-modal-container"),i=e.querySelector(".hph-modal");e.querySelector(".hph-modal-title").textContent=n.title||t.replace("-"," ").replace(/\b\w/g,t=>t.toUpperCase()),this.loadModalContent(t,n),e.style.display="flex",i.style.opacity="0",i.style.transform="scale(0.9)",requestAnimationFrame(()=>{i.style.transition="all 0.3s ease",i.style.opacity="1",i.style.transform="scale(1)"}),this.activeModal={id:t,options:n},document.body.style.overflow="hidden"},loadModalContent:function(t,n){const e=document.querySelector(".hph-modal-body"),i=document.querySelector(".hph-modal-save");t.includes("listing")?this.loadListingForm(e,n):t.includes("lead")?this.loadLeadForm(e,n):this.loadGenericForm(e,n),i.onclick=()=>{if(n.onSave){const t=this.collectFormData(e);n.onSave(t)}this.close()}},loadListingForm:function(t,n){t.innerHTML='\n                    <form class="modal-form">\n                        <div class="form-group">\n                            <label for="listing-title">Property Title</label>\n                            <input type="text" id="listing-title" name="title" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-price">Price</label>\n                            <input type="number" id="listing-price" name="price" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-address">Address</label>\n                            <input type="text" id="listing-address" name="address" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="listing-description">Description</label>\n                            <textarea id="listing-description" name="description" rows="4"></textarea>\n                        </div>\n                    </form>\n                ',n.data&&this.populateForm(t.querySelector(".modal-form"),n.data)},loadLeadForm:function(t,n){t.innerHTML='\n                    <form class="modal-form">\n                        <div class="form-group">\n                            <label for="lead-name">Name</label>\n                            <input type="text" id="lead-name" name="name" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-email">Email</label>\n                            <input type="email" id="lead-email" name="email" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-phone">Phone</label>\n                            <input type="tel" id="lead-phone" name="phone">\n                        </div>\n                        <div class="form-group">\n                            <label for="lead-status">Status</label>\n                            <select id="lead-status" name="status">\n                                <option value="new">New</option>\n                                <option value="contacted">Contacted</option>\n                                <option value="qualified">Qualified</option>\n                                <option value="closed">Closed</option>\n                            </select>\n                        </div>\n                    </form>\n                ',n.data&&this.populateForm(t.querySelector(".modal-form"),n.data)},loadGenericForm:function(t,n){t.innerHTML="<p>Generic form content would go here</p>"},populateForm:function(t,n){Object.keys(n).forEach(e=>{const i=t.querySelector(`[name="${e}"]`);i&&(i.value=n[e])})},collectFormData:function(t){const n=t.querySelector(".modal-form");if(!n)return{};const e=new FormData(n);return Object.fromEntries(e.entries())},close:function(){const t=document.getElementById("hph-modal-container"),n=t.querySelector(".hph-modal");n.style.opacity="0",n.style.transform="scale(0.9)",setTimeout(()=>{t.style.display="none",document.body.style.overflow="",this.activeModal=null},300)}}}),HPH.register("analytics",function(){return{charts:new Map,init:function(t){this.initStatCards(t),this.initCharts(t),this.initReports(t)},initStatCards:function(t){t.querySelectorAll(".stat-card, .dashboard-stat").forEach(t=>this.enhanceStatCard(t))},enhanceStatCard:function(t){const n=t.querySelector(".stat-value"),e=n?.dataset.target;e&&n&&this.animateNumber(n,0,parseInt(e),1e3)},animateNumber:function(t,n,e,i){const o=performance.now(),a=s=>{const c=s-o,r=Math.min(c/i,1),d=Math.floor(n+(e-n)*r);t.textContent=d.toLocaleString(),r<1&&requestAnimationFrame(a)};requestAnimationFrame(a)},initCharts:function(t){t.querySelectorAll(".chart, .analytics-chart").forEach(t=>this.createChart(t))},createChart:function(t){const n=t.dataset.chartType||"line",e=this.parseChartData(t),i=document.createElement("canvas");t.appendChild(i);const o={element:t,canvas:i,type:n,data:e};this.renderChart(o),this.charts.set(t.id||"chart-"+Date.now(),o)},parseChartData:function(t){try{return JSON.parse(t.dataset.chartData||"{}")}catch(n){return{labels:[],datasets:[]}}},renderChart:function(t){const n=t.canvas.getContext("2d"),{width:e,height:i}=t.canvas.getBoundingClientRect();t.canvas.width=e,t.canvas.height=i,"line"===t.type&&t.data.datasets?.length&&this.drawLineChart(n,t.data,e,i)},drawLineChart:function(t,n,e,i){const o=e-80,a=i-80;if(t.clearRect(0,0,e,i),t.strokeStyle="#3b82f6",t.lineWidth=2,n.datasets[0]?.data?.length){const e=n.datasets[0].data,i=Math.max(...e),s=Math.min(...e),c=i-s||1;t.beginPath(),e.forEach((n,i)=>{const r=40+i/(e.length-1)*o,d=40+a-(n-s)/c*a;0===i?t.moveTo(r,d):t.lineTo(r,d)}),t.stroke()}},initReports:function(t){t.querySelectorAll(".generate-report, [data-report]").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const e=t.dataset.report||"general";this.generateReport(e)})})},generateReport:function(t){window.HPH.ajax.request({action:"hph_generate_report",report_type:t,nonce:window.hphNonce||""}).then(t=>{t.download_url&&window.open(t.download_url,"_blank")}).catch(t=>{})}}}),HPH.register("initDashboard",function(){return{init:function(t=document){window.HPH.modules.crud&&window.HPH.modules.crud.init(t),window.HPH.modules.dataTables&&window.HPH.modules.dataTables.init(t),window.HPH.modules.modals&&window.HPH.modules.modals.init(t),window.HPH.modules.analytics&&window.HPH.modules.analytics.init(t),this.initDashboardSpecific(t)},initDashboardSpecific:function(t){document.addEventListener("dashboardRefresh",()=>{this.refreshDashboardData()}),t.querySelectorAll(".auto-save-form").forEach(t=>{t.querySelectorAll("input, select, textarea").forEach(n=>{n.addEventListener("change",()=>{this.autoSaveForm(t)})})})},refreshDashboardData:function(){const t=document.querySelectorAll(".stat-card"),n=document.querySelectorAll(".dashboard-table");t.forEach(t=>{this.reloadStatCard(t)}),n.forEach(t=>{this.reloadTable(t)})},reloadStatCard:function(t){const n=t.dataset.endpoint;n&&window.HPH.ajax.request({action:n}).then(n=>{const e=t.querySelector(".stat-value");e&&void 0!==n.value&&(e.textContent=n.value)})},reloadTable:function(t){const n=t.dataset.endpoint;n&&window.HPH.ajax.request({action:n}).then(n=>{n.html&&(t.querySelector("tbody").innerHTML=n.html)})},autoSaveForm:function(t){const n=new FormData(t);n.append("action","hph_auto_save"),n.append("nonce",window.hphNonce||""),window.HPH.ajax.submitForm(t,{data:n,onSuccess:()=>{this.showSaveIndicator(t)}})},showSaveIndicator:function(t){let n=t.querySelector(".save-indicator");n||(n=document.createElement("span"),n.className="save-indicator",n.textContent="Saved",t.appendChild(n)),n.style.opacity="1",setTimeout(()=>{n.style.opacity="0"},2e3)}}})),window.hphDebug}}});
