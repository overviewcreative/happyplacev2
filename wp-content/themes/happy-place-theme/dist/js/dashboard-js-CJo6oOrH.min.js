import"./chunks/unified-dashboard-C-oa8RGW.min.js";function m(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}class c{constructor(){this.isLoggedIn=(HPUserSystem==null?void 0:HPUserSystem.isLoggedIn)||!1,this.userId=(HPUserSystem==null?void 0:HPUserSystem.userId)||0,this.nonce=(HPUserSystem==null?void 0:HPUserSystem.nonce)||"",this.ajaxUrl=(HPUserSystem==null?void 0:HPUserSystem.ajaxUrl)||"/wp-admin/admin-ajax.php",this.pageStartTime=Date.now(),this.maxScrollDepth=0,this.currentListingId=this.getCurrentListingId(),this.init()}init(){this.initFavoriteButtons(),this.initSaveSearchButtons(),this.initQuickRegistration(),this.initEngagementTracking(),this.initDashboard(),this.initModals(),this.currentListingId&&this.trackListingView()}initFavoriteButtons(){document.addEventListener("click",e=>{e.target.closest(".favorite-btn, .btn-favorite")&&(e.preventDefault(),this.handleFavoriteToggle(e.target.closest(".favorite-btn, .btn-favorite")))})}async handleFavoriteToggle(e){const t=e.dataset.listingId;if(!t)return;if(!this.isLoggedIn){this.showLoginPrompt("Save your favorite properties",{benefits:["Save unlimited favorite properties","Get email alerts for new matches","Track your viewing history"]});return}e.classList.add("loading");const a=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',e.disabled=!0;try{const s=await this.makeRequest("hph_toggle_favorite",{listing_id:t,nonce:this.nonce});s.success?(this.updateFavoriteButton(e,s.data),this.showNotification(s.data.action==="added"?"Property saved to favorites!":"Property removed from favorites",s.data.action==="added"?"success":"info"),this.updateFavoritesCount(s.data.count)):this.showNotification(s.data.message||"Error updating favorite","error")}catch(s){this.showNotification("Error updating favorite","error")}finally{e.classList.remove("loading"),e.innerHTML=a,e.disabled=!1}}updateFavoriteButton(e,t){const a=e.querySelector("i"),s=e.querySelector(".btn-text");t.is_favorited?(e.classList.add("is-favorited"),a&&(a.classList.remove("far"),a.classList.add("fas")),s&&(s.textContent=e.dataset.textRemove||"Saved")):(e.classList.remove("is-favorited"),a&&(a.classList.remove("fas"),a.classList.add("far")),s&&(s.textContent=e.dataset.textAdd||"Save Property"))}updateFavoritesCount(e){document.querySelectorAll(".favorites-count").forEach(a=>{a.textContent=e,a.style.display=e>0?"inline":"none"})}initSaveSearchButtons(){document.addEventListener("click",e=>{e.target.closest(".save-search-btn, #save-current-search")&&(e.preventDefault(),this.handleSaveSearch(e.target.closest(".save-search-btn, #save-current-search")))})}async handleSaveSearch(e){if(!this.isLoggedIn){this.showLoginPrompt("Save your search and get email alerts",{conversion_context:"save_search"});return}const t=this.getCurrentSearchParams();if(Object.keys(t).length===0){this.showNotification("Please perform a search first","warning");return}this.showSaveSearchModal(t)}getCurrentSearchParams(){const e={};return new URLSearchParams(window.location.search).forEach((s,i)=>{s&&i!=="paged"&&(e[i]=s)}),document.querySelectorAll(".active-filter").forEach(s=>{const i=s.dataset.filterKey,n=s.dataset.filterValue;i&&n&&(e[i]=n)}),e}showSaveSearchModal(e){const t=document.getElementById("save-search-modal");if(!t){this.createSaveSearchModal(e);return}this.populateSearchCriteria(e),new bootstrap.Modal(t).show()}createSaveSearchModal(e){document.body.insertAdjacentHTML("beforeend",'\n            <div class="modal fade" id="dynamic-save-search-modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title">Save Your Search</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <form id="dynamic-save-search-form">\n                                <div class="mb-3">\n                                    <label for="search-name-dynamic" class="form-label">Search Name</label>\n                                    <input type="text" class="form-control" id="search-name-dynamic" name="search_name" \n                                           placeholder="e.g., 3BR Houses in Downtown" required>\n                                </div>\n                                \n                                <div class="mb-3">\n                                    <label for="email-frequency-dynamic" class="form-label">Email Frequency</label>\n                                    <select class="form-select" id="email-frequency-dynamic" name="frequency">\n                                        <option value="instant">Instant</option>\n                                        <option value="daily" selected>Daily</option>\n                                        <option value="weekly">Weekly</option>\n                                        <option value="monthly">Monthly</option>\n                                    </select>\n                                </div>\n                                \n                                <div class="search-criteria-summary">\n                                    <h6>Search Criteria:</h6>\n                                    <div id="criteria-list-dynamic"></div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                            <button type="submit" form="dynamic-save-search-form" class="btn btn-primary">Save Search</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),this.populateSearchCriteria(e,"criteria-list-dynamic"),document.getElementById("dynamic-save-search-form").addEventListener("submit",i=>{i.preventDefault(),this.submitSaveSearch(i.target,e)});const a=document.getElementById("dynamic-save-search-modal");new bootstrap.Modal(a).show(),a.addEventListener("hidden.bs.modal",()=>{a.remove()})}populateSearchCriteria(e,t="search-criteria-summary"){const a=document.getElementById(t);if(!a)return;const s={s:"Keywords",location:"Location",property_type:"Property Type",min_price:"Min Price",max_price:"Max Price",bedrooms:"Bedrooms",bathrooms:"Bathrooms",features:"Features"};let i="";Object.keys(e).forEach(n=>{const o=s[n]||n.replace("_"," "),r=e[n];i+='<span class="badge bg-secondary me-1 mb-1">'.concat(o,": ").concat(r,"</span>")}),a.innerHTML=i||'<span class="text-muted">No specific criteria</span>'}async submitSaveSearch(e,t){const a=new FormData(e),s=a.get("search_name"),i=a.get("frequency");if(!s.trim()){this.showNotification("Please enter a search name","warning");return}const n=e.querySelector('[type="submit"]');n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Saving...';try{const o=await this.makeRequest("hph_save_search",{search_name:s,criteria:t,frequency:i,nonce:this.nonce});o.success?(this.showNotification("Search saved successfully! You'll receive email alerts for new matches.","success"),bootstrap.Modal.getInstance(e.closest(".modal")).hide()):this.showNotification(o.data.message||"Error saving search","error")}catch(o){this.showNotification("Error saving search","error")}finally{n.disabled=!1,n.innerHTML="Save Search"}}initQuickRegistration(){document.addEventListener("submit",e=>{e.target.classList.contains("quick-registration-form")&&(e.preventDefault(),this.handleQuickRegistration(e.target))})}async handleQuickRegistration(e){const t=new FormData(e),a=e.querySelector('[type="submit"]'),s=t.get("email"),i=t.get("first_name");if(!s||!i){this.showNotification("Please fill in all required fields","warning");return}const n=a.querySelector(".btn-text"),o=a.querySelector(".btn-loading");n&&o&&(n.style.display="none",o.style.display="inline"),a.disabled=!0;try{const r=await this.makeRequest("quick_register",{first_name:t.get("first_name"),last_name:t.get("last_name"),email:t.get("email"),nonce:e.dataset.nonce||this.nonce});r.success?(this.showNotification(r.data.message,"success"),r.data.redirect?setTimeout(()=>{window.location.href=r.data.redirect},2e3):setTimeout(()=>{window.location.reload()},2e3)):this.showNotification(r.data.message||"Registration failed","error")}catch(r){this.showNotification("Registration error. Please try again.","error")}finally{n&&o&&(n.style.display="inline",o.style.display="none"),a.disabled=!1}}initEngagementTracking(){let e=0;window.addEventListener("scroll",()=>{const t=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);t>e&&(e=t,this.maxScrollDepth=e)}),window.addEventListener("beforeunload",()=>{this.trackTimeOnPage()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.trackTimeOnPage()})}trackTimeOnPage(){if(!this.isLoggedIn)return;const e=Math.floor((Date.now()-this.pageStartTime)/1e3),t=Math.floor(e/60);if(t>0){const a=new URLSearchParams({action:"hph_track_engagement",user_id:this.userId,engagement_action:"time_on_site",minutes:t,scroll_depth:this.maxScrollDepth});navigator.sendBeacon(this.ajaxUrl,a)}}trackListingView(){const e=Date.now();setTimeout(()=>{const t=Math.floor((Date.now()-e)/1e3);this.makeRequest("track_listing_view_enhanced",{listing_id:this.currentListingId,view_time:t,scroll_depth:this.maxScrollDepth,source:"single_listing"}).catch(a=>{})},1e4)}getCurrentListingId(){const e=document.querySelector("[data-listing-id]");return e?e.dataset.listingId:null}initDashboard(){if(window.location.hash&&document.querySelector(".user-dashboard")){const e=window.location.hash.substring(1),t=document.querySelector('[data-bs-target="#'.concat(e,'"]'));t&&new bootstrap.Tab(t).show()}document.addEventListener("shown.bs.tab",e=>{const t=e.target.getAttribute("data-bs-target");if(t){const a=t.substring(1);history.replaceState(null,null,"#"+a)}}),this.loadDashboardData()}async loadDashboardData(){if(document.querySelector(".user-dashboard"))try{const e=document.getElementById("recent-activity");e&&(e.innerHTML='<p class="text-muted">Recent activity will be displayed here.</p>');const t=document.getElementById("recommendations");t&&(t.innerHTML='<p class="text-muted">Recommendations will appear here.</p>')}catch(e){}}initModals(){}showLoginPrompt(e,t={}){const a='\n            <div class="modal fade" id="login-prompt-modal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title">Sign In Required</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <p class="lead">'.concat(e,"</p>\n                            ").concat(t.benefits?'\n                                <div class="benefits-list mb-3">\n                                    <h6>With your free account you can:</h6>\n                                    <ul class="list-unstyled">\n                                        '.concat(t.benefits.map(o=>'<li><i class="fas fa-check text-success me-2"></i>'.concat(o,"</li>")).join(""),"\n                                    </ul>\n                                </div>\n                            "):"",'\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Maybe Later</button>\n                            <a href="/login?redirect_to=').concat(encodeURIComponent(window.location.href),'" class="btn btn-primary">Sign In</a>\n                            <a href="/register?redirect_to=').concat(encodeURIComponent(window.location.href),'" class="btn btn-success">Create Free Account</a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),s=document.getElementById("login-prompt-modal");s&&s.remove(),document.body.insertAdjacentHTML("beforeend",a);const i=document.getElementById("login-prompt-modal");new bootstrap.Modal(i).show(),i.addEventListener("hidden.bs.modal",()=>{i.remove()})}showNotification(e,t="info"){let a=document.querySelector(".toast-container");a||(a=document.createElement("div"),a.className="toast-container position-fixed top-0 end-0 p-3",document.body.appendChild(a));const s="toast-"+Date.now(),i={success:"fa-check-circle text-success",error:"fa-times-circle text-danger",warning:"fa-exclamation-triangle text-warning",info:"fa-info-circle text-info"},n=i[t]||i.info,o='\n            <div id="'.concat(s,'" class="toast" role="alert">\n                <div class="toast-header">\n                    <i class="fas ').concat(n,' me-2"></i>\n                    <strong class="me-auto">Notification</strong>\n                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>\n                </div>\n                <div class="toast-body">\n                    ').concat(e,"\n                </div>\n            </div>\n        ");a.insertAdjacentHTML("beforeend",o);const r=document.getElementById(s);new bootstrap.Toast(r,{autohide:!0,delay:t==="error"?8e3:5e3}).show(),r.addEventListener("hidden.bs.toast",()=>{r.remove()})}async makeRequest(e,t={}){const a=new URLSearchParams({action:e,...t}),s=await fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!s.ok)throw new Error("HTTP error! status: ".concat(s.status));return await s.json()}}document.addEventListener("DOMContentLoaded",()=>{window.userSystem=new c});window.UserSystemManager=c;window.hphDebug&&console.log("HPH Unified Dashboard Bundle Loaded - CRUD/Analytics/Management Redundancies Eliminated");export{m as __vite_legacy_guard};
