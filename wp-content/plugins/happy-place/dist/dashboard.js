!function(){"use strict";var t,e,n={},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return n[t](o,o.exports,a),o.exports}a.m=n,a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.f={},a.e=function(t){return Promise.all(Object.keys(a.f).reduce(function(e,n){return a.f[n](t,e),e},[]))},a.u=function(t){return"vendors.js"},a.miniCssF=function(t){},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t={},e="happy-place:",a.l=function(n,i,o,s){if(t[n])t[n].push(i);else{var r,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==e+o){r=u;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",e+o),r.src=n),t[n]=[i];var h=function(e,i){r.onerror=r.onload=null,clearTimeout(p);var a=t[n];if(delete t[n],r.parentNode&&r.parentNode.removeChild(r),a&&a.forEach(function(t){return t(i)}),e)return e(i)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=h.bind(null,r.onerror),r.onload=h.bind(null,r.onload),l&&document.head.appendChild(r)}},function(){var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t}(),function(){var t={945:0};a.f.j=function(e,n){var i=a.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise(function(n,a){i=t[e]=[n,a]});n.push(i[2]=o);var s=a.p+a.u(e),r=new Error;a.l(s,function(n){if(a.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;r.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",r.name="ChunkLoadError",r.type=o,r.request=s,i[1](r)}},"chunk-"+e,e)}};var e=function(e,n){var i,o,s=n[0],r=n[1],l=n[2],c=0;if(s.some(function(e){return 0!==t[e]})){for(i in r)a.o(r,i)&&(a.m[i]=r[i]);if(l)l(a)}for(e&&e(n);c<s.length;c++)o=s[c],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkhappy_place=self.webpackChunkhappy_place||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();class o{constructor(){this.currentSection="overview",this.init()}init(){this.setupEventListeners(),this.initializeComponents(),this.loadCurrentSection()}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches(".dashboard-nav__link")&&(t.preventDefault(),this.navigateToSection(t.target.dataset.section)),t.target.matches(".btn-save-listing")&&(t.preventDefault(),this.saveListing(t.target.closest("form"))),t.target.matches(".btn-delete-listing")&&(t.preventDefault(),this.deleteListing(t.target.dataset.listingId))}),document.addEventListener("submit",t=>{t.target.matches(".dashboard-form")&&(t.preventDefault(),this.handleFormSubmit(t.target))})}initializeComponents(){this.initCharts(),this.initDataTables(),this.initModals()}async loadCurrentSection(){const t=window.hp_dashboard?.current_section||"overview";await this.navigateToSection(t)}async navigateToSection(t){if(t!==this.currentSection)try{this.showLoading();const e=await this.apiRequest("hp_dashboard_load_section",{section:t});if(!e.success)throw new Error(e.data?.message||"Failed to load section");this.currentSection=t,this.updateSectionContent(e.data),this.updateNavigation(t),history.pushState&&history.pushState(null,null,`/agent-dashboard/${t}`)}catch(t){this.showNotification("Error loading section","error")}finally{this.hideLoading()}}updateSectionContent(t){const e=document.querySelector(".dashboard-content");e&&t.html&&(e.innerHTML=t.html,this.initializeComponents())}updateNavigation(t){document.querySelectorAll(".dashboard-nav__link").forEach(e=>{e.classList.toggle("is-active",e.dataset.section===t)})}async saveListing(t){if(t)try{const e=new FormData(t);e.append("action","hp_save_listing");const n=await this.apiRequest("hp_save_listing",e);if(!n.success)throw new Error(n.data?.message||"Failed to save listing");this.showNotification("Listing saved successfully","success"),"listings"===this.currentSection&&this.refreshListingsTable()}catch(t){this.showNotification("Error saving listing","error")}}async deleteListing(t){if(t&&confirm(window.hp_dashboard?.strings?.confirm_delete||"Are you sure?"))try{const e=await this.apiRequest("hp_delete_listing",{listing_id:t});if(!e.success)throw new Error(e.data?.message||"Failed to delete listing");this.showNotification("Listing deleted successfully","success"),this.refreshListingsTable()}catch(t){this.showNotification("Error deleting listing","error")}}async handleFormSubmit(t){const e=t.dataset.action;if(e)try{const n=new FormData(t);n.append("action",e);const i=await this.apiRequest(e,n);if(!i.success)throw new Error(i.data?.message||"Form submission failed");this.showNotification("Form submitted successfully","success"),i.data?.redirect&&(window.location.href=i.data.redirect)}catch(t){this.showNotification("Error submitting form","error")}}async apiRequest(t,e={}){const n=new FormData;if(e instanceof FormData)for(const[t,i]of e.entries())n.append(t,i);else Object.keys(e).forEach(t=>{n.append(t,e[t])});n.append("action",t),n.append("nonce",window.hp_dashboard?.nonce||"");const i=await fetch(window.hp_dashboard?.ajax_url||"/wp-admin/admin-ajax.php",{method:"POST",body:n});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}initCharts(){document.querySelectorAll("[data-chart]").forEach(async t=>{const e=t.dataset.chart,n=JSON.parse(t.dataset.chartData||"{}");if(e&&n)try{const{Chart:i,registerables:o}=await a.e(96).then(a.bind(a,106));i.register(...o),new i(t,{type:e,data:n,options:{responsive:!0,maintainAspectRatio:!1}})}catch(t){}})}initDataTables(){document.querySelectorAll(".data-table").forEach(t=>{this.makeTableSortable(t),this.addTableSearch(t)})}makeTableSortable(t){t.querySelectorAll("th[data-sortable]").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",()=>{})})}addTableSearch(t){const e=t.parentElement.querySelector(".table-search");e&&e.addEventListener("input",e=>{const n=e.target.value.toLowerCase();t.querySelectorAll("tbody tr").forEach(t=>{const e=t.textContent.toLowerCase();t.style.display=e.includes(n)?"":"none"})})}initModals(){document.addEventListener("click",t=>{t.target.matches("[data-modal]")&&(t.preventDefault(),this.openModal(t.target.dataset.modal)),(t.target.matches(".modal-close")||t.target.matches(".modal-backdrop"))&&this.closeModal()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.closeModal()})}showListingForm(t=null){const e="listing-form-modal";let n=document.getElementById(e);if(n||(n=this.createListingFormModal(e),document.body.appendChild(n)),t)this.loadListingData(t,n);else{const t=n.querySelector("form");t&&t.reset()}this.openModal(e)}createListingFormModal(t){const e=document.createElement("div");return e.id=t,e.className="modal",e.innerHTML='\n            <div class="modal-backdrop"></div>\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h2>Add New Listing</h2>\n                    <button class="modal-close">&times;</button>\n                </div>\n                <div class="modal-body">\n                    <form class="listing-form dashboard-form" data-action="hp_save_listing">\n                        <div class="form-group">\n                            <label for="listing_title">Property Title</label>\n                            <input type="text" id="listing_title" name="title" required>\n                        </div>\n                        \n                        <div class="form-row">\n                            <div class="form-group">\n                                <label for="listing_price">Price</label>\n                                <input type="number" id="listing_price" name="price" required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="listing_status">Status</label>\n                                <select id="listing_status" name="status">\n                                    <option value="active">Active</option>\n                                    <option value="pending">Pending</option>\n                                    <option value="sold">Sold</option>\n                                    <option value="coming_soon">Coming Soon</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <div class="form-row">\n                            <div class="form-group">\n                                <label for="listing_beds">Bedrooms</label>\n                                <input type="number" id="listing_beds" name="bedrooms" min="0">\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="listing_baths">Bathrooms</label>\n                                <input type="number" id="listing_baths" name="bathrooms" min="0" step="0.5">\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="listing_sqft">Square Feet</label>\n                                <input type="number" id="listing_sqft" name="sqft" min="0">\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="listing_address">Street Address</label>\n                            <input type="text" id="listing_address" name="address" required>\n                        </div>\n                        \n                        <div class="form-row">\n                            <div class="form-group">\n                                <label for="listing_city">City</label>\n                                <input type="text" id="listing_city" name="city" required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="listing_state">State</label>\n                                <input type="text" id="listing_state" name="state" maxlength="2" required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="listing_zip">ZIP Code</label>\n                                <input type="text" id="listing_zip" name="zip" required>\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="listing_description">Description</label>\n                            <textarea id="listing_description" name="description" rows="4"></textarea>\n                        </div>\n                        \n                        <input type="hidden" name="listing_id" value="">\n                        \n                        <div class="form-actions">\n                            <button type="button" class="btn btn-secondary modal-close">Cancel</button>\n                            <button type="submit" class="btn btn-primary">Save Listing</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        ',e}async loadListingData(t,e){try{const n=await this.apiRequest("hp_get_listing",{listing_id:t});if(n.success&&n.data){const t=e.querySelector("form"),i=n.data;Object.keys(i).forEach(e=>{const n=t.querySelector(`[name="${e}"]`);n&&(n.value=i[e])}),e.querySelector(".modal-header h2").textContent="Edit Listing"}}catch(t){this.showNotification("Error loading listing data","error")}}openModal(t){const e=document.getElementById(t);e&&(e.classList.add("is-active"),document.body.style.overflow="hidden")}closeModal(){const t=document.querySelector(".modal.is-active");t&&(t.classList.remove("is-active"),document.body.style.overflow="")}refreshListingsTable(){document.querySelector("#listings-table")}showLoading(){const t=document.querySelector(".dashboard-loader");t&&(t.style.display="block")}hideLoading(){const t=document.querySelector(".dashboard-loader");t&&(t.style.display="none")}showNotification(t,e="info"){const n=document.createElement("div");n.className=`dashboard-notification dashboard-notification--${e}`,n.innerHTML=`\n            <span class="notification-message">${t}</span>\n            <button class="notification-close">&times;</button>\n        `,document.body.appendChild(n),setTimeout(()=>{n.remove()},5e3),n.querySelector(".notification-close").addEventListener("click",()=>{n.remove()})}}let s=null;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s=new o,window.showListingForm=t=>{s.showListingForm(t)}}):(s=new o,window.showListingForm=t=>{s.showListingForm(t)})}();