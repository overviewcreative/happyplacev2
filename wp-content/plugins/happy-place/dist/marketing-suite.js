!function(){"use strict";var t,e,a,n,i={},r={};function s(t){var e=r[t];if(void 0!==e)return e.exports;var a=r[t]={exports:{}};return i[t](a,a.exports,s),a.exports}s.m=i,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__},s.t=function(a,n){if(1&n&&(a=this(a)),8&n)return a;if("object"==typeof a&&a){if(4&n&&a.__esModule)return a;if(16&n&&"function"==typeof a.then)return a}var i=Object.create(null);s.r(i);var r={};t=t||[null,e({}),e([]),e(e)];for(var o=2&n&&a;("object"==typeof o||"function"==typeof o)&&!~t.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach(function(t){r[t]=function(){return a[t]}});return r.default=function(){return a},s.d(i,r),i},s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce(function(e,a){return s.f[a](t,e),e},[]))},s.u=function(t){return(96===t?"vendors":t)+".js"},s.miniCssF=function(t){},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a={},n="happy-place:",s.l=function(t,e,i,r){if(a[t])a[t].push(e);else{var o,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var h=l[d];if(h.getAttribute("src")==t||h.getAttribute("data-webpack")==n+i){o=h;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.setAttribute("data-webpack",n+i),o.src=t),a[t]=[e];var f=function(e,n){o.onerror=o.onload=null,clearTimeout(p);var i=a[t];if(delete a[t],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(function(t){return t(n)}),e)return e(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=f.bind(null,o.onerror),o.onload=f.bind(null,o.onload),c&&document.head.appendChild(o)}},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var a=e.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=a[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t}(),function(){var t={950:0};s.f.j=function(e,a){var n=s.o(t,e)?t[e]:void 0;if(0!==n)if(n)a.push(n[2]);else{var i=new Promise(function(a,i){n=t[e]=[a,i]});a.push(n[2]=i);var r=s.p+s.u(e),o=new Error;s.l(r,function(a){if(s.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var i=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;o.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",o.name="ChunkLoadError",o.type=i,o.request=r,n[1](o)}},"chunk-"+e,e)}};var e=function(e,a){var n,i,r=a[0],o=a[1],c=a[2],l=0;if(r.some(function(e){return 0!==t[e]})){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(c)c(s)}for(e&&e(a);l<r.length;l++)i=r[l],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0},a=self.webpackChunkhappy_place=self.webpackChunkhappy_place||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();class o{constructor(){this.canvas=null,this.fabricCanvas=null,this.currentTemplate=null,this.currentListing=null,this.init()}async init(){if(document.querySelector("#marketing-canvas"))try{const t=await Promise.all([s.e(96),s.e(132)]).then(s.t.bind(s,676,23));this.fabric=t.fabric,this.setupCanvas()}catch(t){return}this.setupEventListeners(),this.loadTemplates()}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches(".template-card")&&(t.preventDefault(),this.selectTemplate(t.target.dataset.template)),t.target.matches(".format-option")&&(t.preventDefault(),this.selectFormat(t.target.dataset.format)),t.target.matches(".btn-generate-flyer")&&(t.preventDefault(),this.generateFlyer()),t.target.matches(".btn-download-flyer")&&(t.preventDefault(),this.downloadFlyer(t.target.dataset.format)),t.target.matches(".btn-bulk-generate")&&(t.preventDefault(),this.bulkGenerate())}),document.addEventListener("change",t=>{t.target.matches("#listing-select")&&this.selectListing(t.target.value)})}setupCanvas(){document.getElementById("marketing-canvas")&&(this.fabricCanvas=new this.fabric.Canvas("marketing-canvas",{width:1080,height:1080,backgroundColor:"#ffffff"}),this.fabricCanvas.on("selection:created",()=>{this.showObjectControls()}),this.fabricCanvas.on("selection:cleared",()=>{this.hideObjectControls()}))}async loadTemplates(){try{const t=await this.apiRequest("hp_get_marketing_templates");t.success&&t.data.templates&&this.renderTemplates(t.data.templates)}catch(t){}}renderTemplates(t){const e=document.querySelector(".templates-grid");e&&(e.innerHTML=t.map(t=>`\n            <div class="template-card" data-template="${t.id}">\n                <img src="${t.thumbnail}" alt="${t.name}" class="template-thumbnail">\n                <h3 class="template-name">${t.name}</h3>\n                <p class="template-category">${t.category}</p>\n            </div>\n        `).join(""))}async selectTemplate(t){try{this.showLoading();const e=await this.apiRequest("hp_get_marketing_template",{template_id:t});e.success&&e.data.template&&(this.currentTemplate=e.data.template,this.loadTemplateToCanvas(),this.showFormatOptions())}catch(t){this.showNotification("Error loading template","error")}finally{this.hideLoading()}}async loadTemplateToCanvas(){if(this.fabricCanvas&&this.currentTemplate){this.fabricCanvas.clear();for(const t of this.currentTemplate.elements)await this.addElementToCanvas(t);this.fabricCanvas.renderAll()}}async addElementToCanvas(t){switch(t.type){case"image":await this.addImageElement(t);break;case"text":this.addTextElement(t);break;case"shape":this.addShapeElement(t)}}async addImageElement(t){return new Promise(e=>{this.fabric.Image.fromURL(t.src,a=>{a.set({left:t.position.x,top:t.position.y,scaleX:t.scale?.x||1,scaleY:t.scale?.y||1,selectable:!1!==t.editable}),this.fabricCanvas.add(a),e()})})}addTextElement(t){const e=new this.fabric.Text(t.text,{left:t.position.x,top:t.position.y,fontFamily:t.style.fontFamily||"Arial",fontSize:t.style.fontSize||24,fill:t.style.color||"#000000",fontWeight:t.style.fontWeight||"normal",selectable:!1!==t.editable});this.fabricCanvas.add(e)}addShapeElement(t){let e;switch(t.shape){case"rectangle":e=new this.fabric.Rect({left:t.position.x,top:t.position.y,width:t.properties.width,height:t.properties.height,fill:t.properties.fill||"#000000"});break;case"circle":e=new this.fabric.Circle({left:t.position.x,top:t.position.y,radius:t.properties.radius,fill:t.properties.fill||"#000000"})}e&&(e.set({selectable:!1!==t.editable}),this.fabricCanvas.add(e))}selectListing(t){t&&(this.currentListing=t,this.updateTemplateWithListingData())}async updateTemplateWithListingData(){if(this.currentListing&&this.fabricCanvas)try{const t=await this.apiRequest("hp_get_listing_data",{listing_id:this.currentListing});t.success&&t.data.listing&&this.populateTemplateFields(t.data.listing)}catch(t){}}populateTemplateFields(t){if(this.fabricCanvas.getObjects("text").forEach(e=>{let a=e.text;a=a.replace("{{price}}",this.formatPrice(t.price)),a=a.replace("{{address}}",t.address),a=a.replace("{{beds}}",t.bedrooms),a=a.replace("{{baths}}",t.bathrooms),a=a.replace("{{sqft}}",this.formatNumber(t.square_feet)),a=a.replace("{{agent_name}}",t.agent_name),a=a.replace("{{agent_phone}}",t.agent_phone),e.set("text",a)}),t.featured_image){const e=this.fabricCanvas.getObjects("image").find(t=>"hero"===t.id);e&&this.fabric.Image.fromURL(t.featured_image,t=>{t.set({left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY}),this.fabricCanvas.remove(e),this.fabricCanvas.add(t),this.fabricCanvas.renderAll()})}this.fabricCanvas.renderAll()}selectFormat(t){const e={instagram_post:{width:1080,height:1080},instagram_story:{width:1080,height:1920},facebook_post:{width:1200,height:630},twitter_post:{width:1024,height:512},full_flyer:{width:2550,height:3300}}[t];e&&this.fabricCanvas&&(this.fabricCanvas.setDimensions({width:e.width,height:e.height}),this.fabricCanvas.renderAll())}async generateFlyer(){if(this.fabricCanvas&&this.currentListing)try{this.showLoading();const t=this.fabricCanvas.toDataURL({format:"png",quality:1}),e=await this.apiRequest("hp_save_generated_flyer",{listing_id:this.currentListing,template_id:this.currentTemplate.id,canvas_data:t});e.success&&(this.showNotification("Flyer generated successfully","success"),this.showDownloadOptions(e.data.flyer_id))}catch(t){this.showNotification("Error generating flyer","error")}finally{this.hideLoading()}else this.showNotification("Please select a listing and template","error")}showDownloadOptions(t){const e=document.querySelector(".download-options");if(!e)return;e.innerHTML=`\n            <h3>Download Options</h3>\n            <div class="format-buttons">\n                ${["PNG","JPG","PDF"].map(e=>`\n                    <button class="btn btn-download-flyer" data-format="${e.toLowerCase()}" data-flyer="${t}">\n                        Download ${e}\n                    </button>\n                `).join("")}\n            </div>\n        `,e.style.display="block"}async downloadFlyer(t){if(this.fabricCanvas)try{let e;switch(t){case"png":e=this.fabricCanvas.toDataURL({format:"png",quality:1});break;case"jpg":e=this.fabricCanvas.toDataURL({format:"jpeg",quality:.9});break;case"pdf":return void await this.downloadPDF()}const a=document.createElement("a");a.download=`flyer-${Date.now()}.${t}`,a.href=e,a.click()}catch(t){this.showNotification("Error downloading flyer","error")}}async downloadPDF(){try{const t=this.fabricCanvas.toDataURL({format:"png",quality:1}),e=await this.apiRequest("hp_generate_pdf_flyer",{canvas_data:t});if(e.success&&e.data.pdf_url){const t=document.createElement("a");t.href=e.data.pdf_url,t.download=`flyer-${Date.now()}.pdf`,t.click()}}catch(t){this.showNotification("Error generating PDF","error")}}async bulkGenerate(){const t=this.getSelectedListings(),e=this.getSelectedFormats();if(0!==t.length&&0!==e.length)try{this.showLoading();const a=await this.apiRequest("hp_bulk_generate_flyers",{listings:t,formats:e,template_id:this.currentTemplate.id});if(a.success&&a.data.zip_url){const t=document.createElement("a");t.href=a.data.zip_url,t.download=`marketing-materials-${Date.now()}.zip`,t.click(),this.showNotification("Bulk generation completed","success")}}catch(t){this.showNotification("Error generating materials","error")}finally{this.hideLoading()}else this.showNotification("Please select listings and formats","error")}getSelectedListings(){const t=document.querySelectorAll(".listing-checkbox:checked");return Array.from(t).map(t=>t.value)}getSelectedFormats(){const t=document.querySelectorAll(".format-checkbox:checked");return Array.from(t).map(t=>t.value)}showFormatOptions(){const t=document.querySelector(".format-options");t&&(t.style.display="block")}showObjectControls(){const t=document.querySelector(".object-controls");t&&(t.style.display="block")}hideObjectControls(){const t=document.querySelector(".object-controls");t&&(t.style.display="none")}formatPrice(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(t)}formatNumber(t){return new Intl.NumberFormat("en-US").format(t)}async apiRequest(t,e={}){const a=new FormData;Object.keys(e).forEach(t=>{a.append(t,e[t])}),a.append("action",t),a.append("nonce",window.hp_dashboard?.nonce||"");const n=await fetch(window.hp_dashboard?.ajax_url||"/wp-admin/admin-ajax.php",{method:"POST",body:a});return await n.json()}showLoading(){const t=document.querySelector(".marketing-loader");t&&(t.style.display="block")}hideLoading(){const t=document.querySelector(".marketing-loader");t&&(t.style.display="none")}showNotification(t,e="info"){const a=document.createElement("div");a.className=`marketing-notification marketing-notification--${e}`,a.textContent=t,document.body.appendChild(a),setTimeout(()=>{a.remove()},5e3)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new o}):new o}();